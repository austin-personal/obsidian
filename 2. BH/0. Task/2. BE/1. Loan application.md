## ==1. Click "Apply Loan"==
### <font color="#fbd5b5">1.1 GET /codes?groupCodes=GOOGLE_PLAY_INTEGRITY</font>
![[스크린샷 2025-05-29 오후 6.32.36.png]]
- 목적: 이 API는 **특정 코드 그룹(groupCodes)** 에 속하는 코드 항목들을 클라이언트에 반환하는 기능
	- groupCodes=GOOGLE_PLAY_INTEGRITY
		- **RETURN**: Google Play Integrity 기능을 어떻게 동작시킬지 동적으로 제어하기 위한 설정값(코드항목들)을가져옴
> GOOGLE_PLAY_INTEGRITY란? 
> *<font color="#595959">Google Play Integrity API(이하 Play Integrity)는 Android 앱·게임 개발자가 자사 애플리케이션의 무결성(Integrity)을 확인하고, 사기·개조·비인가 접근 등의 잠재적 위험으로부터 보호할 수 있도록 Google Play가 제공하는 서비스입니다</font>*



### <font color="#fbd5b5">1.2 GET /loan/TC/TC_RL</font>
![[temp_image_1748505261748.png]]
- payLater부터 SQL쿼리까지의 길이 없음 (하단 참고)
![[스크린샷 2025-05-29 오후 5.42.54.png]]
- 목적: 이 API는 클라이언트(앱)가 사용자의 특정 제3자 대출(여기서는 TC) **요약 정보**를 한 번에 내려받아 화면에 표시하고, 필요시 추가 제안을(Suggestion)까지 받을 수 있도록 하는 역할
	- 즉, 과거의 론 기록들을 가져와 새로 론을 신청할때 추천하는데(**론 신청 화면을 구성하는데)** 사용.

> **SqlSessionTemplate**은 외부 라이브러리 (파일을 못 찾음)
> <font color="#595959">**SqlSessionTemplate**은 직접 구현하는 클래스가 아니라,  </font>
> <font color="#595959">MyBatis-Spring에서 제공하는 외부 라이브러리 클래스입니다.</font>
>  <font color="#595959">PayLater.xml에 쿼리가 저장되어있다.</font>
> <font color="#595959"> 쿼리:</font>
```xml
<select id="selectLatestThirdPartyLoan" parameterType="map" resultType="io.tbal.business.domain.paylater.PayLater">

SELECT

<include refid="PAY_LATER_COLUMNS" />

FROM pay_later USE INDEX (ix_userid_paylatertype_paylaterid)

WHERE user_id = #{userId}

AND third_party_company = #{thirdPartyCompany}

AND pay_later_type IN ('TC_RL', 'TC_ICL', 'REPAY_LATER','TC_WL')

AND third_party_uid IS NOT NULL

ORDER BY pay_later_id DESC LIMIT 1;

</select>
```


### <font color="#fbd5b5">1.3 GET /codes?groupCodes=KYC_META_INFO_PARTNER_LOAN</font>
Seq Diagram은 위와 동일
- 목적: **대출용 KYC(신원 인증) 화면에 필요한 모든 메타 정보**를 반환함
	- KYC가 필요한지 안한지 체크 -> **그에 맞게 KYC 관련 UI·플로우 설정** 



### <font color="#fbd5b5">1.4 GET /kyc/proofs?status=AUTHORIZED&type=PAN,ADDRESS_DOC</font>

kyc/proofs를 부르는 컨트롤러를 못찾겠다. -> user라는 다른 레포에 있었다. (Peter가 말해주길 트루밸런스를 입구로 다른 user같은 레포로 호출이 되는 것 같다고 함)

![[스크린샷 2025-05-29 오후 9.23.24.png]]

- 목적: 사용자의 KYC 증빙 문서 리스트를 **상태, 종류별로 필터**해서 내려주고, 승인 여부 반환
	- 사용자가 KYC를 정상적으로 완료했는지, 어떤 서류가 인증되었는지, 추가 서류가 필요한지 등\ 신원확인 프로세스의 핵심 정보를 제공
- 실제 쿼리: 
```xml
<select id="selectKycProofsByUserId" parameterType="String" resultType="io.tbal.user.kyc.model.KycProof">
    SELECT proof_id as proofId
         , user_id as userId
         , type as type
         , status as status
         , document_number as encryptedDocumentNumber
         , kyc_request_seq as kycRequestSeq
         , kyc_vendor_type as kycVendorType
         , created_at as createdAt
     FROM kyc_proof
    WHERE user_id = #{userId}
</select>
```

# 2. Check recomended amount and tenure and Click "Next"
# 3. Do Survey
### <font color="#fbd5b5">3.1 GET /codes?groupCodes=LOCATION_DATA_CONFIG</font>
Seq diagram 위와 동일
- 목적: 대출 청 시작 시점에 필요한 **모든 컨텍스트 정보**(개인 프로필 + 위치·네트워크 + 캠페인 + 상품 기본값)를 한 번에 내려줘서, 앱이 사용자 입력을 최소화하고 동시에 서버 쪽에도 정확한 신청 환경 데이터를 남길 수 있게” 해 주는 역할

### 3.2 POST /v2/common/order
- TB에서 db에 저장하는 플로우
![[Pasted image 20250529215542.png]]
- 오
![[Pasted image 20250529222204.png]]


![[Pasted image 20250529222304.png]]

- TC-LMS에서 POST loan-application 되고 나서 플로우
![[스크린샷 2025-05-29 오후 10.43.38.png]]